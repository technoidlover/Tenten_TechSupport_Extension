<!DOCTYPE html>
<html>
<head>
    <title>Test Real Tenten Response</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .debug { background: #e8f4fd; padding: 10px; margin: 5px 0; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Test Real Tenten HTML Response</h1>
    
    <div class="result">
        <h3>Test Result:</h3>
        <div id="result"></div>
    </div>
    
    <div class="debug">
        <h4>Debug Info:</h4>
        <div id="debug"></div>
    </div>

    <script>
        // Real HTML response từ bạn
        const realHTML = `<style>
                .widthTD {
                    width: 20%;
                }
            </style>
            <div class="info_whois_general">
                <div class="row">
                    <div class="col-sm-8">
                        <div class="ct_left">
                        <div class="info_whois_title_box">
                            <h2>Thông tin WHOIS tên miền <strong class="qb_red">nodesign.vn</strong></h2>
                        </div>
                        <div class="mobile_interface">
                            <table>
                                <tbody>
                                    <tr>
                                    <td class="widthTD">Tên miền : </td>
                                    <td><a href="https://nodesign.vn" target="_blank" class="link_whois">nodesign.vn</a></td>
                                    </tr>
                                    <tr>
                                    <td>Ngày đăng ký : </td>
                                    <td>16/01/2025</td>
                                    </tr>
                                    <tr>
                                    <td>Ngày hết hạn : </td>
                                    <td><strong>16/01/2026</strong></td>
                                    </tr>
                                    <tr>
                                    <td>Chủ sở hữu tên miền : </td>
                                    <td>CÔNG TY TNHH GIẢI PHÁP CÔNG NGHỆ HNG</td>
                                    </tr>
                                    <tr>
                                    <td><span>Cờ trạng thái <a href="#" class="status_flags" aria-hidden="true" data-toggle="tooltip" data-html="true" data-placement="top" data-original-title="Cờ trạng thái tên miền là gì?"></a>:</span>
                                    </td>
                                    <td><ul>
                                        <li>clientTransferProhibited</li>
                                    </ul></td>
                                    </tr>
                                    <tr>
                                    <td>Quản lý tại Nhà đăng ký : </td>
                                    <td>Công ty Cổ phần GMO-Z.com RUNSYSTEM</td>
                                    </tr>
                                    <tr>
                                    <td><span>Nameservers <a href="#" class="status_flags" aria-hidden="true" data-toggle="tooltip" data-html="true" data-placement="top" data-original-title="DNS là gì?"></a>:</span></td>
                                    <td><ul>
                                        <li>rayne.ns.cloudflare.com</li><li>zac.ns.cloudflare.com</li>
                                    </ul></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        </div>
                    </div>
                </div>
        </div>`;

        function parseTentenHTML(htmlData, domain) {
            const debugOutput = [];
            debugOutput.push('=== Starting Parse ===');
            
            const result = {
                domainName: domain,
                creationDate: 'N/A',
                expirationDate: 'N/A',
                registrantName: 'N/A',
                status: 'N/A',
                registrarName: 'N/A',
                nameServers: 'N/A'
            };
            
            // Domain name
            const domainMatch = htmlData.match(/<a[^>]*href="https?:\/\/([^"]+)"[^>]*class="link_whois"[^>]*>([^<]+)<\/a>/i);
            if (domainMatch) {
                result.domainName = domainMatch[2].trim();
                debugOutput.push(`Domain found: ${result.domainName}`);
            }
            
            // Registration date
            const regDateMatch = htmlData.match(/<td[^>]*>Ngày đăng ký\s*:\s*<\/td>\s*<td[^>]*>([^<]+)<\/td>/i);
            if (regDateMatch) {
                result.creationDate = regDateMatch[1].trim();
                debugOutput.push(`Registration date found: ${result.creationDate}`);
            }
            
            // Expiration date
            const expDateMatch = htmlData.match(/<td[^>]*>Ngày hết hạn\s*:\s*<\/td>\s*<td[^>]*>(?:<strong[^>]*>)?([^<]+)(?:<\/strong>)?<\/td>/i);
            if (expDateMatch) {
                result.expirationDate = expDateMatch[1].trim();
                debugOutput.push(`Expiration date found: ${result.expirationDate}`);
            }
            
            // Registrant
            const registrantMatch = htmlData.match(/<td[^>]*>Chủ sở hữu tên miền\s*:\s*<\/td>\s*<td[^>]*>([^<]+)<\/td>/i);
            if (registrantMatch) {
                result.registrantName = registrantMatch[1].trim();
                debugOutput.push(`Registrant found: ${result.registrantName}`);
            }
            
            // Registrar
            const registrarMatch = htmlData.match(/<td[^>]*>Quản lý tại Nhà đăng ký\s*:\s*<\/td>\s*<td[^>]*>([^<]+)<\/td>/i);
            if (registrarMatch) {
                result.registrarName = registrarMatch[1].trim();
                debugOutput.push(`Registrar found: ${result.registrarName}`);
            }
            
            // Status - simple pattern first
            const statusMatch = htmlData.match(/Cờ trạng thái[\s\S]*?<ul>([\s\S]*?)<\/ul>/i);
            if (statusMatch) {
                debugOutput.push(`Status section found: ${statusMatch[1]}`);
                const statusItems = statusMatch[1].match(/<li[^>]*>([^<]+)<\/li>/gi);
                if (statusItems) {
                    const statuses = statusItems.map(item => item.replace(/<[^>]*>/g, '').trim()).filter(s => s);
                    if (statuses.length > 0) {
                        result.status = statuses.join(', ');
                        debugOutput.push(`Status parsed: ${result.status}`);
                    }
                }
            } else {
                debugOutput.push('Status pattern NOT matched');
            }
            
            // Nameservers - simple pattern first
            const nsMatch = htmlData.match(/Nameservers[\s\S]*?<ul>([\s\S]*?)<\/ul>/i);
            if (nsMatch) {
                debugOutput.push(`Nameservers section found: ${nsMatch[1]}`);
                const nsItems = nsMatch[1].match(/<li[^>]*>([^<]+)<\/li>/gi);
                if (nsItems) {
                    const nameServers = nsItems.map(item => item.replace(/<[^>]*>/g, '').trim()).filter(ns => ns);
                    if (nameServers.length > 0) {
                        result.nameServers = nameServers.join(', ');
                        debugOutput.push(`Nameservers parsed: ${result.nameServers}`);
                    }
                }
            } else {
                debugOutput.push('Nameservers pattern NOT matched');
            }
            
            debugOutput.push('=== Final Result ===');
            debugOutput.push(JSON.stringify(result, null, 2));
            
            return { result, debug: debugOutput };
        }

        // Run test
        const testResult = parseTentenHTML(realHTML, 'nodesign.vn');
        
        // Display results
        document.getElementById('result').innerHTML = `<pre>${JSON.stringify(testResult.result, null, 2)}</pre>`;
        document.getElementById('debug').innerHTML = `<pre>${testResult.debug.join('\\n')}</pre>`;
    </script>
</body>
</html>
