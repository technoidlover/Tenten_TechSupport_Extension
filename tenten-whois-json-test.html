<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Tenten WHOIS JSON Parser</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .result {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .label {
            font-weight: bold;
            color: #333;
        }
        .value {
            color: #666;
            margin-left: 10px;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a87;
        }
        .json-input {
            width: 100%;
            height: 200px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Test Tenten WHOIS JSON Parser</h1>
    
    <div>
        <h3>Mẫu JSON Response từ Tenten API:</h3>
        <textarea class="json-input" id="jsonInput">{
  "whois_info": {
    "domain_name": "tenten.vn",
    "creation_date": "2015-11-04T10:00:00Z",
    "expiration_date": "2025-11-04T10:00:00Z", 
    "registrant_name": "Công ty TNHH Tên Miền Việt Nam",
    "domain_status": "clientTransferProhibited https://icann.org/epp#clientTransferProhibited",
    "registrar_name": "Mat Bao Corporation",
    "nameservers": [
      "ns1.tenten.vn",
      "ns2.tenten.vn",
      "ns3.tenten.vn"
    ]
  }
}</textarea>
        
        <button onclick="testParser()">Test Parser</button>
        <button onclick="loadSampleData()">Load Sample Data</button>
    </div>
    
    <div id="results"></div>
    
    <script>
        // Copy parser functions from background.js
        function normalizeTentenData(data) {
            console.log('Normalizing Tenten data:', data);
            
            // Check if it's the expected format with whois_info
            if (data.whois_info) {
                const whoisInfo = data.whois_info;
                
                // Process nameservers array
                let nameServers = 'N/A';
                if (whoisInfo.nameservers && Array.isArray(whoisInfo.nameservers) && whoisInfo.nameservers.length > 0) {
                    nameServers = whoisInfo.nameservers.join(', ');
                }
                
                return {
                    domainName: whoisInfo.domain_name || whoisInfo.domain || data.domain || 'N/A',
                    creationDate: whoisInfo.creation_date || whoisInfo.registered_date || 'N/A',
                    expirationDate: whoisInfo.expiration_date || whoisInfo.expires_date || 'N/A',
                    registrantName: whoisInfo.registrant_name || whoisInfo.registrant_organization || whoisInfo.owner || 'N/A',
                    status: whoisInfo.domain_status || whoisInfo.status || whoisInfo.flags || 'N/A',
                    registrarName: whoisInfo.registrar_name || whoisInfo.registrar || whoisInfo.sponsor || 'N/A',
                    nameServers: nameServers
                };
            }
            
            // Fallback to original logic for other formats
            const result = data.data || data;
            
            return {
                domainName: result.domain_name || result.domain || data.domain || 'N/A',
                creationDate: result.creation_date || result.registered_date || result.creationDate || 'N/A',
                expirationDate: result.expiration_date || result.expires_date || result.expirationDate || 'N/A',
                registrantName: result.registrant_name || result.registrant?.organization || result.owner || 'N/A',
                status: result.domain_status || result.status || result.flags || 'N/A',
                registrarName: result.registrar_name || result.registrar || result.sponsor || 'N/A',
                nameServers: result.name_servers || result.nameservers || result.dns_servers || 'N/A'
            };
        }
        
        function testParser() {
            const jsonInput = document.getElementById('jsonInput').value;
            const resultsDiv = document.getElementById('results');
            
            try {
                const data = JSON.parse(jsonInput);
                const normalized = normalizeTentenData(data);
                
                resultsDiv.innerHTML = `
                    <div class="result">
                        <h3>Kết quả Parser:</h3>
                        <div><span class="label">Tên miền:</span><span class="value">${normalized.domainName}</span></div>
                        <div><span class="label">Ngày đăng ký:</span><span class="value">${normalized.creationDate}</span></div>
                        <div><span class="label">Ngày hết hạn:</span><span class="value">${normalized.expirationDate}</span></div>
                        <div><span class="label">Chủ sở hữu:</span><span class="value">${normalized.registrantName}</span></div>
                        <div><span class="label">Cờ trạng thái:</span><span class="value">${normalized.status}</span></div>
                        <div><span class="label">Nơi đăng ký:</span><span class="value">${normalized.registrarName}</span></div>
                        <div><span class="label">Nameserver:</span><span class="value">${normalized.nameServers}</span></div>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="result" style="background: #ffebee;"><strong>Lỗi:</strong> ${error.message}</div>`;
            }
        }
        
        function loadSampleData() {
            const samples = [
                {
                    name: "Tenten.vn",
                    data: {
                        "whois_info": {
                            "domain_name": "tenten.vn",
                            "creation_date": "2015-11-04T10:00:00Z",
                            "expiration_date": "2025-11-04T10:00:00Z", 
                            "registrant_name": "Công ty TNHH Tên Miền Việt Nam",
                            "domain_status": "clientTransferProhibited https://icann.org/epp#clientTransferProhibited",
                            "registrar_name": "Mat Bao Corporation",
                            "nameservers": [
                                "ns1.tenten.vn",
                                "ns2.tenten.vn",
                                "ns3.tenten.vn"
                            ]
                        }
                    }
                },
                {
                    name: "VNExpress.net",
                    data: {
                        "whois_info": {
                            "domain_name": "vnexpress.net",
                            "creation_date": "2001-01-15T09:30:00Z",
                            "expiration_date": "2026-01-15T09:30:00Z",
                            "registrant_name": "FPT Online",
                            "domain_status": "ok https://icann.org/epp#ok",
                            "registrar_name": "GoDaddy.com, LLC",
                            "nameservers": [
                                "ns1.fpt.net",
                                "ns2.fpt.net"
                            ]
                        }
                    }
                }
            ];
            
            let html = '<h3>Samples được test:</h3>';
            samples.forEach(sample => {
                const normalized = normalizeTentenData(sample.data);
                html += `
                    <div class="result">
                        <h4>${sample.name}</h4>
                        <div><span class="label">Tên miền:</span><span class="value">${normalized.domainName}</span></div>
                        <div><span class="label">Ngày đăng ký:</span><span class="value">${normalized.creationDate}</span></div>
                        <div><span class="label">Ngày hết hạn:</span><span class="value">${normalized.expirationDate}</span></div>
                        <div><span class="label">Chủ sở hữu:</span><span class="value">${normalized.registrantName}</span></div>
                        <div><span class="label">Cờ trạng thái:</span><span class="value">${normalized.status}</span></div>
                        <div><span class="label">Nơi đăng ký:</span><span class="value">${normalized.registrarName}</span></div>
                        <div><span class="label">Nameserver:</span><span class="value">${normalized.nameServers}</span></div>
                    </div>
                `;
            });
            
            document.getElementById('results').innerHTML = html;
        }
        
        // Auto-load samples on page load
        window.onload = () => {
            loadSampleData();
        };
    </script>
</body>
</html>
