<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iNET WHOIS API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        input {
            padding: 10px;
            width: 300px;
            margin-right: 10px;
        }
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            max-height: 600px;
            overflow-y: auto;
        }
        .loading {
            text-align: center;
            color: #666;
        }
        .error {
            color: red;
        }
        .success {
            color: green;
        }
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .endpoint {
            margin: 10px 0;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>iNET WHOIS API Test</h1>
    <div class="input-group">
        <input type="text" id="domainInput" placeholder="Nh·∫≠p t√™n mi·ªÅn (vd: google.com)" value="nodesign.vn">
        <button onclick="testAllEndpoints()">Test All Endpoints</button>
        <button onclick="testMainPage()">Test Main Page</button>
        <button onclick="clearResults()">Clear</button>
    </div>
    
    <div id="result" class="result" style="display: none;"></div>

    <script>
        const endpoints = [
            'https://whois.inet.vn/whois?domain=',
            'https://whois.inet.vn/api/whois?domain=',
            'https://whois.inet.vn/ajax/whois?domain=',
            'https://api.inet.vn/whois/',
            'https://whois.inet.vn/api/domain/',
        ];

        async function testAllEndpoints() {
            const domain = document.getElementById('domainInput').value.trim();
            const resultDiv = document.getElementById('result');
            
            if (!domain) {
                alert('Vui l√≤ng nh·∫≠p t√™n mi·ªÅn');
                return;
            }

            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading">üîç Testing all iNET endpoints...</div>';

            let results = `<h3>Test Results for: ${domain}</h3>`;

            for (const endpoint of endpoints) {
                results += `<div class="endpoint">Testing: ${endpoint}${domain}</div>`;
                
                try {
                    const response = await fetch(endpoint + domain, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json, text/plain, */*',
                            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
                            'Referer': 'https://whois.inet.vn/',
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });

                    const contentType = response.headers.get('content-type') || '';
                    
                    results += `<div class="success">‚úÖ Status: ${response.status} ${response.statusText}</div>`;
                    results += `<div>Content-Type: ${contentType}</div>`;

                    if (contentType.includes('application/json')) {
                        try {
                            const jsonData = await response.json();
                            results += `<div class="success">üìÑ JSON Response:</div>`;
                            results += `<pre>${JSON.stringify(jsonData, null, 2)}</pre>`;
                        } catch (e) {
                            results += `<div class="error">‚ùå Failed to parse JSON: ${e.message}</div>`;
                        }
                    } else {
                        const textData = await response.text();
                        const preview = textData.length > 500 ? textData.substring(0, 500) + '...' : textData;
                        results += `<div>üìÑ Response (${textData.length} chars):</div>`;
                        results += `<pre>${preview}</pre>`;
                        
                        // Check for WHOIS indicators
                        const whoisIndicators = [
                            'Domain Status:', 'Registrar:', 'Creation Date:', 'Registry Domain ID:',
                            'Expiration Date:', 'Name Server:', 'registrant', 'domain_status'
                        ];
                        
                        const foundIndicators = whoisIndicators.filter(indicator => 
                            textData.toLowerCase().includes(indicator.toLowerCase())
                        );
                        
                        if (foundIndicators.length > 0) {
                            results += `<div class="success">üéØ Found WHOIS indicators: ${foundIndicators.join(', ')}</div>`;
                        } else {
                            results += `<div class="error">‚ö†Ô∏è No WHOIS indicators found</div>`;
                        }
                    }

                } catch (error) {
                    results += `<div class="error">‚ùå Error: ${error.message}</div>`;
                }
                
                results += '<hr>';
            }

            resultDiv.innerHTML = results;
        }

        async function testMainPage() {
            const domain = document.getElementById('domainInput').value.trim();
            const resultDiv = document.getElementById('result');
            
            if (!domain) {
                alert('Vui l√≤ng nh·∫≠p t√™n mi·ªÅn');
                return;
            }

            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading">üîç Testing main iNET page...</div>';

            try {
                // First, get the main page to see the structure
                const mainResponse = await fetch(`https://whois.inet.vn/whois?domain=${domain}`);
                const mainHtml = await mainResponse.text();
                
                let results = `<h3>Main Page Test for: ${domain}</h3>`;
                results += `<div class="success">‚úÖ Status: ${mainResponse.status}</div>`;
                results += `<div>Page length: ${mainHtml.length} characters</div>`;
                
                // Look for JavaScript patterns that might indicate AJAX calls
                const scriptMatches = mainHtml.match(/fetch\(['"]([^'"]+)['"]/g) || [];
                const ajaxMatches = mainHtml.match(/ajax.*url['"]?\s*:\s*['"]([^'"]+)['"]/gi) || [];
                const apiMatches = mainHtml.match(/api['"\/]([^'"\/\s]+)/gi) || [];
                
                if (scriptMatches.length > 0) {
                    results += `<div class="success">üîç Found fetch calls:</div>`;
                    scriptMatches.forEach(match => {
                        results += `<div class="endpoint">${match}</div>`;
                    });
                }
                
                if (ajaxMatches.length > 0) {
                    results += `<div class="success">üîç Found AJAX URLs:</div>`;
                    ajaxMatches.forEach(match => {
                        results += `<div class="endpoint">${match}</div>`;
                    });
                }
                
                if (apiMatches.length > 0) {
                    results += `<div class="success">üîç Found API patterns:</div>`;
                    apiMatches.forEach(match => {
                        results += `<div class="endpoint">${match}</div>`;
                    });
                }
                
                // Show a snippet of the HTML
                const htmlPreview = mainHtml.substring(0, 1000) + '...';
                results += `<div>üìÑ HTML Preview:</div>`;
                results += `<pre>${htmlPreview}</pre>`;
                
                resultDiv.innerHTML = results;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        function clearResults() {
            document.getElementById('result').style.display = 'none';
        }

        // Allow Enter key to trigger search
        document.getElementById('domainInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                testAllEndpoints();
            }
        });
    </script>
</body>
</html>
